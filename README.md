# Miniserver Upload Files

## –ó–∞–¥–∞—á–∞

> üìé
> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å HTTP —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
> <br>
> –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ csv(–Ω–∞–ø—Ä. –¥–∞—Ç–∞—Å–µ—Ç—ã —Å Kaggle).
> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –∏ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—Å—è –æ—Ç —Ñ–∞–π–ª–∞ –∫ —Ñ–∞–π–ª—É.
> <br>
> –ü–æ–º–∏–º–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
> –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–ª–æ–Ω–∫–∞
> –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –æ–¥–Ω–æ–º—É
> –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å—Ç–æ–ª–±—Ü–∞–º
> <br>
> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ª—é–±–æ–π –∏–∑ —è–∑—ã–∫–æ–≤:
> python, C++, C#, –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–µ —á—Ç–æ –ø–æ–∫–∞–∂–µ—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º.
> <br>
> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
>- –ø–æ–∫—Ä—ã—Ç–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏
>- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
>- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –Ω–∞–ø—Ä. —É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
>- Dockerfile –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤ Docker

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ö–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏](#–∫–æ–Ω–µ—á–Ω—ã–µ-—Ç–æ—á–∫–∏)
- [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—É—Å–ª–æ–≤–∏—è)
- [–¢–µ—Å—Ç–∏—Ä—É–µ–º](#—Ç–µ—Å—Ç–∏—Ä—É–µ–º)
- [–ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å](#–∑–∞–ø—É—Å–∫–∞–µ–º-–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)
- [–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã](#–ø–æ–ª–µ–∑–Ω—ã–µ-—Ä–µ—Å—É—Ä—Å—ã)
- [–î–∞–ª—å–Ω–µ–π—à–∞—è —Ä–∞–±–æ—Ç–∞](#–¥–∞–ª—å–Ω–µ–π—à–∞—è-—Ä–∞–±–æ—Ç–∞)

## –ö–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏

![endpoints](imgs/endpoints.png)

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

- python3.12
- docker engine 24.0.6
- –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ c –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
  ```bash
  python3.12 -m venv venv
  source venv/bin/activate 
  pip install -r src/requirements.txt
  ```
- —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞-–∫–æ–Ω—Ñ–∏–≥–∞ –∏ –∏–∑–º–µ–Ω–∏—Ç—å
  ```bash
  cp .example.env .env
  ```

## –¢–µ—Å—Ç–∏—Ä—É–µ–º

- –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å redis
  ```bash
  cd src/rd 
  sudo docker compose --env-file '../../.env' up
  ```
- –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–ø—É—Å–∫–∞–µ–º `pytest`.
  ```bash
  coverage run -m pytest
  ```
  ```bash
  coverage report -m
  ```
  ```text
    Name                             Stmts   Miss  Cover   Missing
    --------------------------------------------------------------
    src/__init__.py                      0      0   100%
    src/app/__init__.py                  0      0   100%
    src/app/constants.py                10      0   100%
    src/app/dependencies.py             56      4    93%   40, 48, 56, 85
    src/app/main.py                      7      0   100%
    src/app/routers/__init__.py          0      0   100%
    src/app/routers/token.py            17      0   100%
    src/app/routers/uploadfiles.py      59      2    97%   26, 52
    src/app/routers/users.py            52      3    94%   25, 44, 70
    src/app/schemas/__init__.py          0      0   100%
    src/app/schemas/token.py             6      0   100%
    src/app/schemas/users.py            17      0   100%
    src/app/sql_app/__init__.py          0      0   100%
    src/app/sql_app/crud.py             30      1    97%   22
    tests/__init__.py                    0      0   100%
    tests/conftest.py                   51      2    96%   86-87
    tests/test_main.py                 252      4    98%   355-359
    --------------------------------------------------------------
    TOTAL                              557     16    97%
   ```
  ```bash
  coverage html
  ```
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é —Å–µ—Ä–≤–µ—Ä
  ```bash
  cd src
  uvicorn app.main:app
  ```
- –°–æ–∑–¥–∞—Ç—å —Å—É–ø–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ```bash
  python3 -m app.scripts.create_admin
  ```
- –ü–æ–∏–≥—Ä–∞—Ç—å—Å—è —Å redis
  ```bash
  sudo docker compose --env-file ../../.env up -docker
  sudo docker exec -it rd-db-1 redis-cli
  ```

## –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å

- –±—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã, —Ö–æ—Å—Ç redis –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `db`
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ gunicorn –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Ñ–∞–π–ª–µ `gunicorn.conf.py`
- –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ `run-app.bash`
  ```bash
  chmod u+x run-app.bash
  ```
- –ø–æ–¥–Ω–∏–º–∞–µ—Ç –¥–æ–∫–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  ```bash
  cd src/app/microservice
  sudo docker compose --env-file ../../.env up
  ```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

+ redis docker compose https://geshan.com.np/blog/2022/01/redis-docker/
+ redis docker official https://redis.io/docs/getting-started/install-stack/docker/
+ redis-py https://github.com/redis/redis-py
+ redis-stack docker https://hub.docker.com/r/redis/redis-stack
+ Redis URI and connection details https://github.com/lettuce-io/lettuce-core/wiki/Redis-URI-and-connection-details
+ ACL LIST https://redis.io/docs/management/security/acl/
+ redis config https://redis.io/docs/management/config/
+ redis.config example https://raw.githubusercontent.com/redis/redis/7.2/redis.conf
+ async read files in python https://superfastpython.com/aiofiles-for-asyncio-in-python/
+ async vs sync read/write in file on
  python https://stackoverflow.com/questions/57578794/why-is-reading-and-calling-an-api-from-a-file-slower-using-python-async-than-syn
+ magic asyncio.sleep https://stackoverflow.com/questions/65973786/why-does-asyncio-sleep0-make-my-code-faster
+ fast redis(pipelining) https://redis.io/docs/manual/pipelining/
+ docker compose .env https://docs.docker.com/compose/environment-variables/set-environment-variables/
+ import
  packages https://ru.stackoverflow.com/questions/1343188/%D0%9A%D0%B0%D0%BA-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D0%B8%D0%B7-%D1%81%D0%BE%D1%81%D0%B5%D0%B4%D0%BD%D0%B5%D0%B9-%D0%B4%D0%B8%D1%80%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%B8
+ __init__.py https://stackoverflow.com/questions/448271/what-is-init-py-for
+ scripts vs modules (
  stackoverflow.com) https://stackoverflow.com/questions/14132789/relative-imports-for-the-billionth-time
+ scripts vs modules (realpython.com) https://realpython.com/run-python-scripts/
+ csv datasets https://www.datablist.com/learn/csv/download-sample-csv-files
+ test files https://github.com/tiangolo/fastapi/issues/1536

## –î–∞–ª—å–Ω–µ–π—à–∞—è —Ä–∞–±–æ—Ç–∞

- –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å redis –∫–æ–¥ —Å –ø–∞–∫–µ—Ç–æ–º redis-OM. –û–¥–Ω–∞–∫–æ —Å—Ç–∞—Ç—É—Å –µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - alpha3 https://pypi.org/project/redis-om/
- –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ nginx
- –¥–æ–±–∞–≤–∏—Ç—å HTTPS –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫
